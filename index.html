<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AksharaNama ‚Äì Privacy-First Image Name Tool</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#ffffff">
<meta name="description" content="Create circular image name badges. Privacy-first. No data stored.">

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- Google Fonts (Indian languages) -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Noto+Sans+Tamil:wght@400;700&family=Noto+Sans+Kannada:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&family=Noto+Serif+Devanagari:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f7f7f7;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:16px;
  gap:12px;
}

h1{margin:4px 0;font-size:20px}

label{font-size:13px;font-weight:600}

select,input,button{
  width:260px;
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:#0066ff;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

button:disabled{opacity:.5}

.preview{
  width:260px;
  height:260px;
  border-radius:50%;
  overflow:hidden;
  border:3px solid #ddd;
  background:#fff;
}

.preview img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.controls{
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:center;
}

.install-btn{
  background:#000;
}

canvas{display:none}
</style>
</head>

<body>

<h1>AksharaNama</h1>
<small>Privacy-first ‚Ä¢ No data stored</small>

<div class="controls">

<label>Upload Image</label>
<input type="file" accept="image/*" id="imgInput">

<label>Language</label>
<select id="language">
  <option value="te">Telugu</option>
  <option value="en">English</option>
  <option value="ta">Tamil</option>
  <option value="kn">Kannada</option>
  <option value="hi">Hindi</option>
  <option value="sa">Sanskrit</option>
</select>

<label>Font</label>
<select id="fontSelect"></select>

<label>Enter Name</label>
<input type="text" id="nameInput" placeholder="Type name here">

<button id="downloadBtn" disabled>‚¨áÔ∏è Download Image</button>
<button id="installBtn" class="install-btn" hidden>üì± Install App</button>

</div>

<div class="preview">
  <img id="imgPreview">
</div>

<canvas id="canvas" width="1080" height="1080"></canvas>

<script>
/* ---------- FONT MAP ---------- */
const fonts={
  te:["Noto Sans Telugu"],
  ta:["Noto Sans Tamil"],
  kn:["Noto Sans Kannada"],
  hi:["Noto Sans Devanagari"],
  sa:["Noto Serif Devanagari"],
  en:["Arial"]
};

const imgInput=document.getElementById("imgInput");
const imgPreview=document.getElementById("imgPreview");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const nameInput=document.getElementById("nameInput");
const fontSelect=document.getElementById("fontSelect");
const language=document.getElementById("language");
const downloadBtn=document.getElementById("downloadBtn");

/* ---------- LOAD FONTS ---------- */
function loadFonts(){
  fontSelect.innerHTML="";
  fonts[language.value].forEach(f=>{
    const o=document.createElement("option");
    o.value=f;o.textContent=f;
    fontSelect.appendChild(o);
  });
}
loadFonts();
language.onchange=()=>{loadFonts();drawCanvas();};

/* ---------- IMAGE UPLOAD ---------- */
imgInput.onchange=()=>{
  const f=imgInput.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    imgPreview.src=r.result;
    drawCanvas();
  };
  r.readAsDataURL(f);
};

/* ---------- LIVE UPDATE ---------- */
[nameInput,fontSelect].forEach(el=>{
  el.addEventListener("input",drawCanvas);
});

/* ---------- DRAW CURVED TEXT ---------- */
function drawCurvedText(ctx,text,cx,cy,radius,startAngle,font){
  if(!text)return;
  ctx.save();
  ctx.font=font;
  ctx.fillStyle="#fff";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.shadowColor="rgba(0,0,0,0.6)";
  ctx.shadowBlur=4;

  const chars=text.split("");
  const step=Math.PI/(chars.length+2);

  chars.forEach((ch,i)=>{
    const a=startAngle+i*step;
    ctx.save();
    ctx.translate(cx+radius*Math.cos(a),cy+radius*Math.sin(a));
    ctx.rotate(a+Math.PI/2);
    ctx.fillText(ch,0,0);
    ctx.restore();
  });
  ctx.restore();
}

/* ---------- MAIN DRAW ---------- */
function drawCanvas(){
  if(!imgPreview.src)return;

  const img=new Image();
  img.onload=()=>{
    ctx.clearRect(0,0,1080,1080);

    ctx.save();
    ctx.beginPath();
    ctx.arc(540,540,540,0,Math.PI*2);
    ctx.clip();

    ctx.drawImage(img,0,0,1080,1080);
    ctx.restore();

    drawCurvedText(
      ctx,
      nameInput.value,
      540,540,
      460,
      Math.PI*0.85,
      `700 64px ${fontSelect.value}`
    );

    downloadBtn.disabled=false;
  };
  img.src=imgPreview.src;
}

/* ---------- DOWNLOAD ---------- */
downloadBtn.onclick=()=>{
  const a=document.createElement("a");
  a.download="aksharanama.png";
  a.href=canvas.toDataURL("image/png");
  a.click();
};

/* ---------- PWA INSTALL ---------- */
let deferredPrompt;
const installBtn=document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.hidden=false;
});

installBtn.onclick=async()=>{
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  installBtn.hidden=true;
};

/* ---------- SERVICE WORKER ---------- */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
