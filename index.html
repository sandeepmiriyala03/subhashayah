<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AksharaNama – Privacy-First Image Name Tool</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#ffffff">
<meta name="description" content="Create circular image name badges. Privacy-first. No data stored.">

<link rel="manifest" href="manifest.json">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Noto+Sans+Tamil:wght@400;700&family=Noto+Sans+Kannada:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&family=Noto+Serif+Devanagari:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f5f6f8;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:16px;
  gap:12px;
}

h1{margin:4px 0;font-size:20px}
small{color:#555}

label{
  font-size:13px;
  font-weight:600;
  align-self:flex-start;
}

select,input,button{
  width:260px;
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:#0066ff;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  border:none;
}

button:disabled{opacity:.5}

.preview{
  width:260px;
  height:260px;
  border-radius:50%;
  overflow:hidden;
  border:3px solid #ddd;
  background:#fff;
}

.preview img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.controls{
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
}

/* FAB Install Button */
.fab{
  position:fixed;
  bottom:16px;
  right:16px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:#000;
  color:#fff;
  font-size:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 6px 16px rgba(0,0,0,.3);
  cursor:pointer;
  z-index:1000;
}

canvas{display:none}
</style>
</head>

<body>

<h1>AksharaNama</h1>
<small>Privacy-first • No data stored</small>

<div class="controls">

<label for="imgInput">Upload Image</label>
<input type="file" accept="image/*" id="imgInput">

<label for="language">Language</label>
<select id="language">
  <option value="te">Telugu</option>
  <option value="en">English</option>
  <option value="ta">Tamil</option>
  <option value="kn">Kannada</option>
  <option value="hi">Hindi</option>
  <option value="sa">Sanskrit</option>
</select>

<label for="fontSelect">Font</label>
<select id="fontSelect"></select>

<label for="nameInput">Enter Name</label>
<input type="text" id="nameInput" placeholder="Type name here">

<button id="downloadBtn" disabled>⬇️ Download Image</button>

</div>

<div class="preview">
  <img id="imgPreview">
</div>

<!-- FAB -->
<div id="installFab" class="fab" hidden title="Install App">⬇️</div>

<canvas id="canvas" width="1080" height="1080"></canvas>

<script>
/* Fonts */
const fonts={
  te:["Noto Sans Telugu"],
  ta:["Noto Sans Tamil"],
  kn:["Noto Sans Kannada"],
  hi:["Noto Sans Devanagari"],
  sa:["Noto Serif Devanagari"],
  en:["Arial"]
};

const imgInput=imgPreview=document.getElementById("imgInput");
const imgPreviewEl=document.getElementById("imgPreview");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const nameInput=document.getElementById("nameInput");
const fontSelect=document.getElementById("fontSelect");
const language=document.getElementById("language");
const downloadBtn=document.getElementById("downloadBtn");

/* Load fonts */
function loadFonts(){
  fontSelect.innerHTML="";
  fonts[language.value].forEach(f=>{
    const o=document.createElement("option");
    o.value=f;o.textContent=f;
    fontSelect.appendChild(o);
  });
}
loadFonts();
language.onchange=()=>{loadFonts();drawCanvas();};

/* Image upload */
imgInput.onchange=()=>{
  const f=imgInput.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    imgPreviewEl.src=r.result;
    drawCanvas();
  };
  r.readAsDataURL(f);
};

[nameInput,fontSelect].forEach(el=>{
  el.addEventListener("input",drawCanvas);
});

/* Curved text */
function drawCurvedText(text,font){
  if(!text)return;
  ctx.save();
  ctx.font=font;
  ctx.fillStyle="#fff";
  ctx.shadowColor="rgba(0,0,0,.6)";
  ctx.shadowBlur=4;

  const chars=text.split("");
  const radius=460;
  const start=Math.PI*0.85;
  const step=Math.PI/(chars.length+2);

  chars.forEach((ch,i)=>{
    const a=start+i*step;
    ctx.save();
    ctx.translate(540+radius*Math.cos(a),540+radius*Math.sin(a));
    ctx.rotate(a+Math.PI/2);
    ctx.fillText(ch,0,0);
    ctx.restore();
  });
  ctx.restore();
}

/* Draw canvas */
function drawCanvas(){
  if(!imgPreviewEl.src)return;

  const img=new Image();
  img.onload=()=>{
    ctx.clearRect(0,0,1080,1080);

    ctx.save();
    ctx.beginPath();
    ctx.arc(540,540,540,0,Math.PI*2);
    ctx.clip();
    ctx.drawImage(img,0,0,1080,1080);
    ctx.restore();

    drawCurvedText(
      nameInput.value,
      `700 64px ${fontSelect.value}`
    );

    downloadBtn.disabled=false;
  };
  img.src=imgPreviewEl.src;
}

/* Download */
downloadBtn.onclick=()=>{
  const a=document.createElement("a");
  a.download="aksharanama.png";
  a.href=canvas.toDataURL("image/png");
  a.click();
};

/* PWA FAB */
let deferredPrompt;
const installFab=document.getElementById("installFab");

window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  installFab.hidden=false;
});

installFab.onclick=async()=>{
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  installFab.hidden=true;
};

/* Service Worker */
if("serviceWorker"in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
