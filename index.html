<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AksharaNama Pro ‚Äì Privacy-First Designer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0066ff">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Ramabhadra&family=Gidugu&family=Mandali&family=NTR&family=RaviPrakash&family=Tenali+Ramakrishna&family=Timmana&family=Chathura:wght@400;700&family=Ramaraja&family=Ponnala&family=Sree+Krushnadevaraya&family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root { --primary: #0066ff; --bg: #f0f4f8; --card: #ffffff; --highlight: #fff3cd; --success: #28a745; }
  *{box-sizing:border-box; transition: all 0.2s ease; -webkit-tap-highlight-color: transparent; }
  
  body{
    margin:0; font-family: 'Poppins', sans-serif;
    background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 10px;
    min-height: 100vh;
  }
  
  .app-container { width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 12px; }
  header { text-align: center; display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 5px 0; }
  header h1 { margin: 0; font-size: 1.2rem; color: #1a1a1a; }
  .help-trigger { background: #000; color: #fff; border-radius: 50%; width: 32px; height: 32px; border: none; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; }

  .lang-header { background: var(--highlight); border: 2px solid #ffc107; padding: 12px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
  .info-box { background: #eef4ff; border-left: 5px solid var(--primary); padding: 12px; border-radius: 12px; font-size: 13px; color: #334e81; line-height: 1.5; }

  .preview-card { background: var(--card); padding: 15px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.06); display: flex; flex-direction: column; align-items: center; }
  .preview-wrapper { width: min(70vw, 260px); height: min(70vw, 260px); border-radius: 50%; background: #e0e0e0; border: 4px solid #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.1); overflow: hidden; position: relative; }
  canvas#pCanvas { width: 100% !important; height: 100% !important; }

  .controls-grid { background: var(--card); padding: 15px; border-radius: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.06); }
  .control-group { display: flex; flex-direction: column; gap: 4px; }
  .full-width { grid-column: span 2; }
  label { font-size: 11px; font-weight: 700; color: #666; text-transform: uppercase; }
  input[type="text"], select, input[type="file"] { padding: 10px; border: 1.5px solid #eee; border-radius: 10px; font-size: 14px; background: #fafafa; width: 100%; }

  .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 5px; }
  button { padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 5px; }
  .btn-main { background: var(--success); color: white; width: 100%; }
  .btn-sec { background: #f0f0f0; color: #555; }
  .btn-wa { background: #25D366; color: white; grid-column: span 2; }

  .fab-install { position: fixed; bottom: 20px; right: 20px; background: #000; color: #fff; border: none; border-radius: 30px; padding: 12px 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: none; align-items: center; gap: 8px; z-index: 1000; cursor: pointer; font-size: 14px; }

  footer { margin-top: 15px; text-align: center; padding: 10px; color: #888; font-size: 12px; }
  #canvas { display: none; }
</style>
</head>
<body>

<div class="app-container">
  <header>
    <h1>AksharaNama Pro</h1>
    <button class="help-trigger" onclick="toggleHelp()">?</button>
  </header>

  <div class="lang-header">
    <label>üåê Language / ‡∞≠‡∞æ‡∞∑</label>
    <select id="lang" onchange="loadFonts()">
      <option value="te">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
      <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
      <option value="en">English</option>
    </select>
  </div>

  <div class="info-box" id="helpBox"></div>

  <div class="preview-card">
    <div class="preview-wrapper">
      <canvas id="pCanvas" width="260" height="260"></canvas>
    </div>
    <div class="control-group full-width" style="margin-top:12px; width: 100%;">
        <label id="lblZoom">üîç Zoom (‡∞ú‡±Ç‡∞Æ‡±ç)</label>
        <input type="range" id="imgZoom" min="1" max="3" step="0.05" value="1" style="accent-color: var(--primary);">
    </div>
  </div>

  <div class="controls-grid">
    <div class="control-group full-width">
      <label id="lblPhoto">1. üì∏ Photo (‡∞´‡±ã‡∞ü‡±ã)</label>
      <input type="file" id="imgInput" accept="image/*">
    </div>

    <div class="control-group full-width">
      <label id="lblName">2. ‚úçÔ∏è Name (‡∞™‡±á‡∞∞‡±Å)</label>
      <input type="text" id="nameInput" placeholder="Enter name" value="‡∞™‡±á‡∞∞‡±Å">
    </div>

    <div class="control-group">
      <label id="lblFont">Style</label>
      <select id="fontSelect"></select>
    </div>

    <div class="control-group">
        <label id="lblPos">Position</label>
        <select id="pos">
          <option value="bottom">Bottom</option>
          <option value="top">Top</option>
          <option value="center" selected>Center</option>
        </select>
    </div>

    <div class="control-group">
      <label>üé® Text</label>
      <input type="color" id="textColor" value="#ffffff">
    </div>

    <div class="control-group">
      <label>üñºÔ∏è Border</label>
      <input type="color" id="borderColor" value="#0066ff">
    </div>

    <input type="hidden" id="fontWeight" value="bold">
    <input type="hidden" id="borderSize" value="12">
    <input type="hidden" id="fSize" value="65">

    <div class="btn-group full-width">
      <button class="btn-sec" onclick="location.reload()">Reset</button>
      <button id="dlBtn" class="btn-main">üíæ Download</button>
      <button class="btn-wa" onclick="shareWA()">üì≤ Share on WhatsApp</button>
    </div>
  </div>

  <footer>
    <p>¬© 2026 Sandeep Miriyala ‚Äî Yuktishala AI</p>
    <p>üîí Privacy First Priority</p>
    <p id="currentDateTime" style="font-weight: 700; color: #444;"></p>
  </footer>
</div>

<button id="installFab" class="fab-install">üì≤ Install App</button>

<canvas id="canvas" width="1080" height="1080"></canvas>

<script>
// 1. THIS HELPER MUST BE AT THE TOP
const el = (id) => document.getElementById(id);

// 2. NOW WE CAN GET ELEMENTS
const installFab = el('installFab');
const canvas = el('canvas'), ctx = canvas.getContext('2d');
const pCanvas = el('pCanvas'), pctx = pCanvas.getContext('2d');
let userImg = null;
let deferredPrompt;

// 3. APP LOGIC
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installFab.style.display = 'flex';
});

installFab.addEventListener('click', async () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') installFab.style.display = 'none';
        deferredPrompt = null;
    }
});

const fontMap = {
  te: ["Noto Sans Telugu", "Ramabhadra", "Gidugu", "Mandali", "NTR", "RaviPrakash", "Tenali Ramakrishna", "Timmana", "Chathura", "Ramaraja", "Ponnala", "Sree Krushnadevaraya"],
  en: ["Poppins", "Arial", "Roboto"],
  hi: ["Noto Sans Devanagari", "Hind"]
};

const translations = {
  te: {
    guide: "<strong>üöÄ 3 ‡∞∏‡±ç‡∞ü‡±Ü‡∞™‡±ç‡∞∏‡±ç:</strong><ol><li><b>Photo</b> ‡∞∏‡±Ü‡∞≤‡±Ü‡∞ï‡±ç‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</li><li>‡∞™‡±á‡∞∞‡±Å <b>Type</b> ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</li><li><b>Download</b> ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞Ç‡∞°‡∞ø.</li></ol>",
    lblPhoto: "1. üì∏ ‡∞´‡±ã‡∞ü‡±ã ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø", 
    lblName: "2. ‚úçÔ∏è ‡∞Æ‡±Ä ‡∞™‡±á‡∞∞‡±Å ‡∞∞‡∞æ‡∞Ø‡∞Ç‡∞°‡∞ø", 
    lblZoom: "üîç ‡∞ú‡±Ç‡∞Æ‡±ç",
    lblFont: "‡∞∏‡±ç‡∞ü‡±à‡∞≤‡±ç", lblPos: "‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç"
  },
  hi: {
    guide: "<strong>üöÄ 3 ‡§Ü‡§∏‡§æ‡§® ‡§∏‡•ç‡§ü‡•á‡§™‡•ç‡§∏:</strong><ol><li><b>Photo</b> ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</li><li>‡§Ö‡§™‡§®‡§æ <b>Name</b> ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§</li><li><b>Download</b> ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§</li></ol>",
    lblPhoto: "1. üì∏ ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç", 
    lblName: "2. ‚úçÔ∏è ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç", 
    lblZoom: "üîç ‡§ú‡§º‡•Ç‡§Æ",
    lblFont: "‡§∏‡•ç‡§ü‡§æ‡§á‡§≤", lblPos: "‡§∏‡•ç‡§•‡§æ‡§®"
  },
  en: {
    guide: "<strong>üöÄ 3 Steps:</strong><ol><li>Select <b>Photo</b>.</li><li>Type <b>Name</b>.</li><li>Click <b>Download</b>.</li></ol>",
    lblPhoto: "1. üì∏ Pick Photo", 
    lblName: "2. ‚úçÔ∏è Type Name", 
    lblZoom: "üîç Zoom",
    lblFont: "Style", lblPos: "Position"
  }
};

function loadFonts() {
  const lang = el('lang').value;
  const sel = el('fontSelect');
  sel.innerHTML = "";
  
  fontMap[lang].forEach(f => {
    const o = document.createElement("option"); 
    o.value = f; o.textContent = f; 
    sel.appendChild(o);
  });

  const data = translations[lang] || translations['en'];
  
  // Update all labels safely
  el('helpBox').innerHTML = data.guide;
  el('lblPhoto').textContent = data.lblPhoto;
  el('lblName').textContent = data.lblName;
  el('lblZoom').textContent = data.lblZoom;
  el('lblFont').textContent = data.lblFont;
  el('lblPos').textContent = data.lblPos;

  document.fonts.ready.then(draw);
}

function updateFooter() {
    const now = new Date();
    el('currentDateTime').textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}

window.onload = () => { updateFooter(); loadFonts(); };

function toggleHelp() {
  const box = el('helpBox');
  box.style.display = box.style.display === 'none' ? 'block' : 'none';
}

el('imgInput').onchange = (e) => {
    const reader = new FileReader();
    reader.onload = (ev) => {
        userImg = new Image();
        userImg.onload = draw;
        userImg.src = ev.target.result;
    };
    if(e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
};

function drawCurved(context, text, cx, cy, radius, startAngle, fSize, font) {
    if (!text) return;
    context.font = `bold ${fSize}px "${font}"`;
    const chars = text.split("");
    const totalWidth = context.measureText(text).width;
    const angularWidth = totalWidth / radius;
    let currentAngle = startAngle - (angularWidth / 2);

    chars.forEach(char => {
        const w = context.measureText(char).width;
        context.save();
        context.translate(cx, cy);
        context.rotate(currentAngle + (w / (2 * radius)));
        context.fillText(char, 0, -radius);
        context.restore();
        currentAngle += w / radius;
    });
}

function draw() {
    [ {c:ctx, s:1080}, {c:pctx, s:260} ].forEach(canv => {
        const c = canv.c, scale = canv.s / 1080, mid = canv.s / 2;
        const zoom = parseFloat(el('imgZoom').value);

        c.clearRect(0,0,canv.s,canv.s);
        const bSize = 24 * scale;
        c.fillStyle = el('borderColor').value;
        c.beginPath(); c.arc(mid, mid, mid, 0, Math.PI*2); c.fill();

        c.save();
        c.beginPath(); c.arc(mid, mid, mid - bSize, 0, Math.PI*2); c.clip();
        
        if (userImg) {
            const min = Math.min(userImg.width, userImg.height);
            const dSize = canv.s * zoom;
            const off = (dSize - canv.s) / 2;
            c.drawImage(userImg, (userImg.width-min)/2, (userImg.height-min)/2, min, min, -off, -off, dSize, dSize);
        } else {
            c.fillStyle = "#eee"; c.fillRect(0,0,canv.s,canv.s);
        }
        c.restore();

        c.fillStyle = el('textColor').value;
        c.shadowColor = "rgba(0,0,0,0.6)";
        c.shadowBlur = 8 * scale;
        c.textAlign = "center";
        c.textBaseline = "middle";

        const text = el('nameInput').value;
        const fontSize = 70 * scale;
        const font = el('fontSelect').value;
        const pos = el('pos').value;

        if (pos === 'bottom') {
            drawCurved(c, text, mid, mid, mid - (bSize + 50*scale), Math.PI/2, fontSize, font);
        } else if (pos === 'top') {
            drawCurved(c, text, mid, mid, mid - (bSize + 50*scale), -Math.PI/2, fontSize, font);
        } else {
            c.font = `bold ${fontSize}px "${font}"`;
            c.fillText(text, mid, mid);
        }
    });
}

function shareWA() {
    alert("Download the image first, then attach it to your WhatsApp status!");
}

['nameInput', 'textColor', 'borderColor', 'pos', 'imgZoom', 'fontSelect'].forEach(id => {
    el(id).addEventListener('input', draw);
});

el('dlBtn').onclick = () => {
    if(!userImg) return alert("Pick a photo!");
    const link = document.createElement('a');
    link.download = 'my_badge.png';
    link.href = canvas.toDataURL('image/png', 1.0);
    link.click();
};

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker Registered!', reg))
        .catch(err => console.log('Service Worker Failed!', err));
    });
  }
</script>
</body>
</html>