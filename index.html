<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AksharaNama Pro ‚Äì Privacy-First Designer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="manifest" href="manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Noto+Sans+Tamil:wght@400;700&family=Noto+Sans+Kannada:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root { --primary: #0066ff; --bg: #f0f4f8; --card: #ffffff; }
  *{box-sizing:border-box; transition: all 0.2s ease;}
  body{
    margin:0; font-family: system-ui, -apple-system, sans-serif;
    background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px;
  }
  
  .app-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 15px; }
  
  header { text-align: center; display: flex; justify-content: space-between; align-items: center; width: 100%; }
  header h1 { margin: 0; font-size: 22px; color: #1a1a1a; }
  .help-trigger { background: #000; color: #fff; border-radius: 50%; width: 28px; height: 28px; border: none; cursor: pointer; font-weight: bold; }

  /* INSTRUCTIONS BOX */
  .info-box {
    background: #eef4ff; border-left: 4px solid var(--primary); padding: 15px;
    border-radius: 12px; font-size: 13px; color: #334e81; line-height: 1.4;
    margin-bottom: 10px;
  }
  .info-box ol { margin: 5px 0 0 18px; padding: 0; }

  /* PREVIEW SECTION */
  .preview-card {
    background: var(--card); padding: 20px; border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: flex; flex-direction: column; align-items: center;
  }
  
  .preview-wrapper {
    width: 260px; height: 260px; border-radius: 50%;
    background: #e0e0e0; border: 4px solid #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    overflow: hidden; position: relative;
  }

  /* CONTROLS */
  .controls-grid {
    background: var(--card); padding: 20px; border-radius: 24px;
    display: grid; grid-template-columns: 1fr 1fr; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  }

  .control-group { display: flex; flex-direction: column; gap: 4px; }
  .full-width { grid-column: span 2; }

  label { font-size: 11px; font-weight: 700; color: #999; text-transform: uppercase; }
  input[type="text"], select, input[type="file"] {
    padding: 10px; border: 1.5px solid #eee; border-radius: 10px; font-size: 14px; background: #fafafa;
  }

  .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 5px; }
  button { padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; }
  .btn-main { background: var(--primary); color: white; }
  .btn-sec { background: #f0f0f0; color: #555; }

  /* PWA FAB */
  .fab-install {
    position: fixed; bottom: 20px; right: 20px;
    width: 60px; height: 60px; border-radius: 50%;
    background: #000; color: #fff; display: flex;
    align-items: center; justify-content: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    cursor: pointer; z-index: 100; font-size: 24px;
    border: none; display: none;
  }

  #canvas { display: none; }
</style>
</head>
<body>

<div class="app-container">
  <header>
    <h1>AksharaNama Pro</h1>
    <button class="help-trigger" onclick="toggleHelp()">?</button>
  </header>

  <div class="info-box" id="helpBox">
    <strong>üöÄ Quick Guide:</strong>
    <ol>
      <li><b>Upload:</b> Pick a photo from your device.</li>
      <li><b>Zoom:</b> Use the slider to center your face.</li>
      <li><b>Style:</b> Choose language, colors, and border size.</li>
      <li><b>Download:</b> Save your high-quality badge!</li>
    </ol>
  </div>

  <div class="preview-card">
    <div class="preview-wrapper">
      <canvas id="pCanvas" width="260" height="260"></canvas>
    </div>
    <div class="control-group full-width" style="margin-top:15px; width: 100%;">
        <label>üîç Image Zoom</label>
        <input type="range" id="imgZoom" min="1" max="3" step="0.05" value="1">
    </div>
  </div>

  <div class="controls-grid">
    <div class="control-group full-width">
      <label>1. Pick Photo</label>
      <input type="file" id="imgInput" accept="image/*">
    </div>

    <div class="control-group full-width">
      <label>2. Your Name</label>
      <input type="text" id="nameInput" placeholder="TYPE NAME" value="AKSHARA">
    </div>

    <div class="control-group">
      <label>Language</label>
      <select id="lang">
        <option value="en">English</option>
        <option value="te">Telugu</option>
        <option value="hi">Hindi</option>
        <option value="ta">Tamil</option>
        <option value="kn">Kannada</option>
      </select>
    </div>

    <div class="control-group">
      <label>Text Color</label>
      <input type="color" id="textColor" value="#ffffff" style="height:40px; width:100%;">
    </div>

    <div class="control-group">
      <label>Border Color</label>
      <input type="color" id="borderColor" value="#0066ff" style="height:40px; width:100%;">
    </div>

    <div class="control-group">
      <label>Border Width</label>
      <input type="range" id="borderSize" min="0" max="40" value="12">
    </div>

    <div class="control-group">
        <label>Text Position</label>
        <select id="pos">
          <option value="bottom">Bottom Curve</option>
          <option value="top">Top Curve</option>
          <option value="center">Center</option>
        </select>
    </div>

    <div class="control-group">
        <label>Font Size</label>
        <input type="range" id="fSize" min="30" max="100" value="65">
    </div>

    <div class="btn-group full-width">
      <button class="btn-sec" onclick="location.reload()">Reset</button>
      <button id="dlBtn" class="btn-main">Download Badge</button>
    </div>
  </div>
</div>

<button id="installFab" class="fab-install">üì≤</button>

<canvas id="canvas" width="1080" height="1080"></canvas>

<script>
const fonts = { en:"Arial", te:"Noto Sans Telugu", hi:"Noto Sans Devanagari", ta:"Noto Sans Tamil", kn:"Noto Sans Kannada" };

const el = (id) => document.getElementById(id);
const canvas = el('canvas'), ctx = canvas.getContext('2d');
const pCanvas = el('pCanvas'), pctx = pCanvas.getContext('2d');

let userImg = null;

// Initial Draw
window.onload = draw;

function toggleHelp() {
  const box = el('helpBox');
  box.style.display = box.style.display === 'none' ? 'block' : 'none';
}

el('imgInput').onchange = (e) => {
    const reader = new FileReader();
    reader.onload = (event) => {
        userImg = new Image();
        userImg.onload = draw;
        userImg.src = event.target.result;
    };
    if(e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
};

function drawCurved(context, text, cx, cy, radius, startAngle, fSize) {
    if (!text) return;
    context.font = `bold ${fSize}px ${fonts[el('lang').value]}`;
    const chars = text.split("");
    const totalWidth = context.measureText(text).width;
    const angularWidth = totalWidth / radius;
    let currentAngle = startAngle - (angularWidth / 2);

    chars.forEach(char => {
        const w = context.measureText(char).width;
        context.save();
        context.translate(cx, cy);
        context.rotate(currentAngle + (w / (2 * radius)));
        context.fillText(char, 0, -radius);
        context.restore();
        currentAngle += w / radius;
    });
}

function draw() {
    [ {c:ctx, s:1080}, {c:pctx, s:260} ].forEach(canv => {
        const c = canv.c;
        const scale = canv.s / 1080;
        const mid = canv.s / 2;
        const zoom = parseFloat(el('imgZoom').value);

        c.clearRect(0,0,canv.s,canv.s);

        // 1. Border
        const bSize = parseInt(el('borderSize').value) * scale * 2;
        c.fillStyle = el('borderColor').value;
        c.beginPath();
        c.arc(mid, mid, mid, 0, Math.PI*2);
        c.fill();

        // 2. Image
        c.save();
        c.beginPath();
        c.arc(mid, mid, mid - bSize, 0, Math.PI*2);
        c.clip();
        
        if (userImg) {
            const iw = userImg.width, ih = userImg.height;
            const min = Math.min(iw, ih);
            const drawSize = canv.s * zoom;
            const offset = (drawSize - canv.s) / 2;
            c.drawImage(userImg, (iw-min)/2, (ih-min)/2, min, min, -offset, -offset, drawSize, drawSize);
        } else {
            c.fillStyle = "#f5f5f5";
            c.fillRect(0,0,canv.s,canv.s);
            c.fillStyle = "#999";
            c.font = `${24*scale}px sans-serif`;
            c.textAlign = "center";
            c.fillText("PREVIEW AREA", mid, mid);
        }
        c.restore();

        // 3. Text Styling
        c.fillStyle = el('textColor').value;
        c.shadowColor = "rgba(0,0,0,0.7)";
        c.shadowBlur = 10 * scale;
        c.textAlign = "center";
        c.textBaseline = "middle";

        const text = el('nameInput').value.toUpperCase();
        const fontSize = parseInt(el('fSize').value) * scale;
        const pos = el('pos').value;

        if (pos === 'bottom') {
            drawCurved(c, text, mid, mid, mid - (bSize + 55*scale), Math.PI/2, fontSize);
        } else if (pos === 'top') {
            drawCurved(c, text, mid, mid, mid - (bSize + 55*scale), -Math.PI/2, fontSize);
        } else {
            c.font = `bold ${fontSize}px ${fonts[el('lang').value]}`;
            c.fillText(text, mid, mid);
        }
    });
}

['nameInput', 'lang', 'textColor', 'borderColor', 'borderSize', 'pos', 'fSize', 'imgZoom'].forEach(id => {
    el(id).addEventListener('input', draw);
});

el('dlBtn').onclick = () => {
    if(!userImg) return alert("Upload a photo first!");
    const link = document.createElement('a');
    link.download = 'badge.png';
    link.href = canvas.toDataURL('image/png', 1.0);
    link.click();
};

let defPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  defPrompt = e;
  el('installFab').style.display = 'flex';
});

el('installFab').onclick = async () => {
  if (defPrompt) {
    defPrompt.prompt();
    const { outcome } = await defPrompt.userChoice;
    if (outcome === 'accepted') el('installFab').style.display = 'none';
    defPrompt = null;
  }
};
</script>
</body>
</html>